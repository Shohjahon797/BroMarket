import 'package:flutter/material.dart';
import 'dart:math';

void main() {
  runApp(const BroMarketApp());
}

class BroMarketApp extends StatelessWidget {
  const BroMarketApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'BRO MARKET',
      debugShowCheckedModeBanner: false,
      theme: ThemeData(
        primaryColor: const Color(0xFFD946A6),
        primarySwatch: Colors.pink,
        scaffoldBackgroundColor: const Color(0xFFF8F9FA),
        appBarTheme: const AppBarTheme(
          backgroundColor: Colors.white,
          foregroundColor: Colors.black,
          elevation: 0,
          centerTitle: true,
          iconTheme: IconThemeData(color: Colors.black),
        ),
        fontFamily: 'Roboto',
      ),
      home: const WelcomeScreen(),
    );
  }
}

// ========== MODELLAR ==========
class Product {
  final String id;
  final String title;
  final String description;
  final double otherStorePrice;
  final double ourPrice;
  final String location;
  final String category;
  final String condition;
  final DateTime createdAt;
  final String sellerName;
  final String sellerPhone;
  final bool isNegotiable;
  final bool hasDelivery;
  bool isFavorite;
  final int views;
  final int likes;
  final int imageIndex;
  final List<String> tags;
  final String storeName;

  Product({
    required this.id,
    required this.title,
    required this.description,
    required this.otherStorePrice,
    required this.ourPrice,
    required this.location,
    required this.category,
    required this.condition,
    required this.createdAt,
    required this.sellerName,
    required this.sellerPhone,
    this.isNegotiable = true,
    this.hasDelivery = true,
    this.isFavorite = false,
    this.views = 0,
    this.likes = 0,
    required this.imageIndex,
    this.tags = const [],
    required this.storeName,
  });

  double get discountAmount => otherStorePrice - ourPrice;
  double get discountPercentage => ((discountAmount / otherStorePrice) * 100);

  String get timeAgo {
    final diff = DateTime.now().difference(createdAt);
    if (diff.inDays > 365) return '${(diff.inDays / 365).floor()} yil oldin';
    if (diff.inDays > 30) return '${(diff.inDays / 30).floor()} oy oldin';
    if (diff.inDays > 0) return '${diff.inDays} kun oldin';
    if (diff.inHours > 0) return '${diff.inHours} soat oldin';
    return 'Hozirgina';
  }
}

class CartItem {
  final Product product;
  int quantity;
  bool isSelected;

  CartItem({required this.product, this.quantity = 1, this.isSelected = true});

  double get totalPrice => product.ourPrice * quantity;
}

class User {
  final String id;
  final String name;
  final String phone;
  final String email;
  final DateTime joinedDate;
  final int ordersCount;
  final double totalSpent;

  User({
    required this.id,
    required this.name,
    required this.phone,
    required this.email,
    required this.joinedDate,
    this.ordersCount = 0,
    this.totalSpent = 0,
  });
}

// ========== GLOBAL MA'LUMOTLAR ==========
User currentUser = User(
  id: '1',
  name: 'Foydalanuvchi',
  phone: '+998917080813',
  email: 'user@bromarket.uz',
  joinedDate: DateTime.now().subtract(const Duration(days: 30)),
  ordersCount: 12,
  totalSpent: 45000000,
);

List<Product> allProducts = [];
List<Product> favoriteProducts = [];
List<CartItem> cartItems = [];

// ========== YORDAMCHI FUNKSIYALAR ==========
String formatPrice(double price) {
  if (price >= 1000000) {
    return '${(price / 1000000).toStringAsFixed(1)} mln';
  } else if (price >= 1000) {
    return '${(price / 1000).toStringAsFixed(0)} ming';
  }
  return price.toStringAsFixed(0);
}

// ========== MAHSULOT GENERATORI ==========
class ProductGenerator {
  static final Random _random = Random();
  static final List<String> _sellers = [
    'BRO Market Premium',
    'BRO Market Official',
    'BRO Market Express',
    'BRO Market Trusted',
  ];
  static final List<String> _sellerPhones = ['+998917080813', '+998770670384'];

  static String _randomPhone() =>
      _sellerPhones[_random.nextInt(_sellerPhones.length)];

  // Emoji yoki iconlar bilan mahsulot rasmlari
  static final List<IconData> _phoneIcons = [
    Icons.phone_iphone,
    Icons.phone_android,
    Icons.smartphone,
    Icons.phone,
  ];

  static final List<IconData> _perfumeIcons = [
    Icons.spa,
    Icons.air,
    Icons.water_drop,
    Icons.clean_hands,
  ];

  static final List<IconData> _carIcons = [
    Icons.directions_car,
    Icons.car_rental,
    Icons.local_taxi,
    Icons.directions_car_filled,
  ];

  static final List<IconData> _clothesIcons = [
    Icons.checkroom,
    Icons.umbrella,
    Icons.dry_cleaning,
    Icons.face_retouching_natural,
  ];

  static final List<IconData> _electronicsIcons = [
    Icons.computer,
    Icons.laptop,
    Icons.headphones,
    Icons.smart_display,
  ];

  static final List<IconData> _homeIcons = [
    Icons.home,
    Icons.chair,
    Icons.kitchen,
    Icons.bed,
  ];

  static final List<String> _storeNames = [
    'Uzum Market',
    'OLX',
    'Alif Shop',
    'Zood Mall',
    'EPOCH',
    'Artel',
    'MyAuto',
  ];

  static void generateProducts() {
    allProducts.clear();

    // 1. TELEFONLAR
    final phoneBrands = ['iPhone', 'Samsung', 'Xiaomi', 'Huawei'];
    final phoneModels = {
      'iPhone': ['15 Pro Max', '15 Pro', '15', '14 Pro Max', '14 Pro', '14'],
      'Samsung': ['S23 Ultra', 'S23+', 'S23', 'Z Fold 5', 'Z Flip 5', 'A54'],
      'Xiaomi': ['13 Pro', '13 Lite', 'Redmi Note 12 Pro', 'Redmi Note 12'],
      'Huawei': ['P60 Pro', 'Mate 50 Pro', 'Nova 11', 'P50 Pro'],
    };

    for (int i = 1; i <= 30; i++) {
      String brand = phoneBrands[_random.nextInt(phoneBrands.length)];
      List<String> models = phoneModels[brand]!;
      String model = models[_random.nextInt(models.length)];
      int storage = [128, 256, 512][_random.nextInt(3)];
      String color = ['Qora', 'Oq', 'Kumush', 'Yashil'][_random.nextInt(4)];
      String store = _storeNames[_random.nextInt(_storeNames.length)];

      double otherPrice = (8000000 + _random.nextDouble() * 12000000);
      double ourPrice = otherPrice - (50000 + _random.nextDouble() * 300000);

      allProducts.add(
        Product(
          id: 'PH${i.toString().padLeft(6, '0')}',
          title: '$brand $model ${storage}GB $color',
          description:
              'Yangi holatda, qutisida, 1 yil kafolat. Original mahsulot, tezkor yetkazib berish.',
          otherStorePrice: otherPrice,
          ourPrice: ourPrice,
          location: 'Toshkent, Barcha tumanlar',
          category: 'Telefon',
          condition: 'Yangi',
          createdAt: DateTime.now().subtract(
            Duration(days: _random.nextInt(30)),
          ),
          sellerName: _sellers[_random.nextInt(_sellers.length)],
          sellerPhone: _randomPhone(),
          imageIndex: _random.nextInt(_phoneIcons.length),
          storeName: store,
          views: 100 + _random.nextInt(5000),
          likes: 20 + _random.nextInt(300),
        ),
      );
    }

    // 2. PARFYUMERIYA
    final perfumeBrands = [
      'Chanel',
      'Dior',
      'Gucci',
      'Versace',
      'Armani',
      'Tom Ford',
    ];
    final perfumeTypes = [
      'Eau de Parfum',
      'Eau de Toilette',
      'Perfume Oil',
      'Cologne',
    ];
    final perfumeSizes = ['50ml', '100ml', '150ml', '200ml'];

    for (int i = 1; i <= 20; i++) {
      String brand = perfumeBrands[_random.nextInt(perfumeBrands.length)];
      String type = perfumeTypes[_random.nextInt(perfumeTypes.length)];
      String size = perfumeSizes[_random.nextInt(perfumeSizes.length)];
      String scent = [
        'Vanilla',
        'Musk',
        'Citrus',
        'Floral',
      ][_random.nextInt(4)];
      String store = _storeNames[_random.nextInt(_storeNames.length)];

      double otherPrice = (200000 + _random.nextDouble() * 1800000);
      double ourPrice = otherPrice - (10000 + _random.nextDouble() * 50000);

      allProducts.add(
        Product(
          id: 'PF${i.toString().padLeft(6, '0')}',
          title: '$brand $type $size - $scent',
          description:
              'Original parfyum, yangi holatda, qutisida. Uzoq muddatli hid, erkaklar/ayollar uchun.',
          otherStorePrice: otherPrice,
          ourPrice: ourPrice,
          location: 'Toshkent, Markaziy do\'kon',
          category: 'Parfyumeriya',
          condition: 'Yangi',
          createdAt: DateTime.now().subtract(
            Duration(days: _random.nextInt(20)),
          ),
          sellerName: _sellers[_random.nextInt(_sellers.length)],
          sellerPhone: _randomPhone(),
          imageIndex: _random.nextInt(_perfumeIcons.length),
          storeName: store,
          views: 80 + _random.nextInt(3000),
          likes: 15 + _random.nextInt(200),
        ),
      );
    }

    // 3. AVTOMOBILLAR
    final carBrands = ['Toyota', 'Chevrolet', 'Hyundai', 'Kia'];
    final carModels = {
      'Toyota': ['Camry', 'Corolla', 'RAV4', 'Land Cruiser'],
      'Chevrolet': ['Malibu', 'Spark', 'Cobalt', 'Nexia 3'],
      'Hyundai': ['Sonata', 'Elantra', 'Tucson', 'Santa Fe'],
      'Kia': ['Sportage', 'Sorento', 'K5', 'Cerato'],
    };

    for (int i = 1; i <= 15; i++) {
      String brand = carBrands[_random.nextInt(carBrands.length)];
      List<String> models = carModels[brand]!;
      String model = models[_random.nextInt(models.length)];
      int year = 2019 + _random.nextInt(5);
      String color = ['Oq', 'Qora', 'Kumush', 'Ko\'k'][_random.nextInt(4)];
      String store = _storeNames[_random.nextInt(_storeNames.length)];

      double otherPrice = (30000000 + _random.nextDouble() * 200000000);
      double ourPrice = otherPrice - (500000 + _random.nextDouble() * 5000000);

      allProducts.add(
        Product(
          id: 'CAR${i.toString().padLeft(6, '0')}',
          title: '$brand $model ${year}-yil $color',
          description:
              'Yaxshi holatda, ${10000 + _random.nextInt(100000)} km yurgan. Mexanika toza, ruxsatnoma bor.',
          otherStorePrice: otherPrice,
          ourPrice: ourPrice,
          location: 'Toshkent, Avtosalon',
          category: 'Avtomobil',
          condition: 'Yaxshi',
          createdAt: DateTime.now().subtract(
            Duration(days: _random.nextInt(60)),
          ),
          sellerName: _sellers[_random.nextInt(_sellers.length)],
          sellerPhone: _randomPhone(),
          imageIndex: _random.nextInt(_carIcons.length),
          storeName: store,
          views: 500 + _random.nextInt(10000),
          likes: 50 + _random.nextInt(500),
        ),
      );
    }

    // 4. KIYIM
    final clothesBrands = ['Nike', 'Adidas', 'Zara', 'LC Waikiki'];
    final clothesTypes = ['Futbolka', 'Shim', 'Kurtka', 'Ko\'ylak', 'Kostyum'];

    for (int i = 1; i <= 20; i++) {
      String brand = clothesBrands[_random.nextInt(clothesBrands.length)];
      String type = clothesTypes[_random.nextInt(clothesTypes.length)];
      String size = ['S', 'M', 'L', 'XL'][_random.nextInt(4)];
      String color = ['Qora', 'Oq', 'Kulrang', 'Ko\'k'][_random.nextInt(4)];
      String store = _storeNames[_random.nextInt(_storeNames.length)];

      double otherPrice = (50000 + _random.nextDouble() * 500000);
      double ourPrice = otherPrice - (5000 + _random.nextDouble() * 20000);

      allProducts.add(
        Product(
          id: 'CL${i.toString().padLeft(6, '0')}',
          title: '$brand $type hajmi $size $color',
          description:
              'Yangi, original kiyim, sifatli mato. Tezkor yetkazib berish.',
          otherStorePrice: otherPrice,
          ourPrice: ourPrice,
          location: 'Toshkent, Kiyim do\'koni',
          category: 'Kiyim',
          condition: 'Yangi',
          createdAt: DateTime.now().subtract(
            Duration(days: _random.nextInt(15)),
          ),
          sellerName: _sellers[_random.nextInt(_sellers.length)],
          sellerPhone: _randomPhone(),
          imageIndex: _random.nextInt(_clothesIcons.length),
          storeName: store,
          views: 60 + _random.nextInt(2000),
          likes: 10 + _random.nextInt(150),
        ),
      );
    }

    // 5. ELEKTRONIKA
    final electronics = [
      'Noutbuk',
      'Planshet',
      'Smart-soat',
      'Naushnik',
      'Kolonka',
    ];

    for (int i = 1; i <= 15; i++) {
      String item = electronics[_random.nextInt(electronics.length)];
      String brand = [
        'Apple',
        'Samsung',
        'Xiaomi',
        'Huawei',
      ][_random.nextInt(4)];
      String store = _storeNames[_random.nextInt(_storeNames.length)];

      double otherPrice = (500000 + _random.nextDouble() * 10000000);
      double ourPrice = otherPrice - (30000 + _random.nextDouble() * 200000);

      allProducts.add(
        Product(
          id: 'EL${i.toString().padLeft(6, '0')}',
          title: '$brand $item',
          description:
              'Yangi elektronika, kafolat bilan. O\'zbekistonda rasmiy kafolat.',
          otherStorePrice: otherPrice,
          ourPrice: ourPrice,
          location: 'Toshkent, Elektronika markazi',
          category: 'Elektronika',
          condition: 'Yangi',
          createdAt: DateTime.now().subtract(
            Duration(days: _random.nextInt(25)),
          ),
          sellerName: _sellers[_random.nextInt(_sellers.length)],
          sellerPhone: _randomPhone(),
          imageIndex: _random.nextInt(_electronicsIcons.length),
          storeName: store,
          views: 120 + _random.nextInt(4000),
          likes: 25 + _random.nextInt(250),
        ),
      );
    }

    // 6. UY-RO'ZG'OR
    final homeItems = ['Mebel', 'Oshxona anjomi', 'Tekstil', 'Dekor'];

    for (int i = 1; i <= 10; i++) {
      String item = homeItems[_random.nextInt(homeItems.length)];
      String store = _storeNames[_random.nextInt(_storeNames.length)];

      double otherPrice = (100000 + _random.nextDouble() * 5000000);
      double ourPrice = otherPrice - (15000 + _random.nextDouble() * 100000);

      allProducts.add(
        Product(
          id: 'HM${i.toString().padLeft(6, '0')}',
          title: 'Uy uchun $item',
          description:
              'Sifatli uy-ro\'zg\'or buyumlari. Yetkazib berish va o\'rnatish bepul.',
          otherStorePrice: otherPrice,
          ourPrice: ourPrice,
          location: 'Toshkent, Uy-ro\'zg\'or markazi',
          category: 'Uy-ro\'zg\'or',
          condition: 'Yangi',
          createdAt: DateTime.now().subtract(
            Duration(days: _random.nextInt(40)),
          ),
          sellerName: _sellers[_random.nextInt(_sellers.length)],
          sellerPhone: _randomPhone(),
          imageIndex: _random.nextInt(_homeIcons.length),
          storeName: store,
          views: 70 + _random.nextInt(2500),
          likes: 12 + _random.nextInt(180),
        ),
      );
    }
  }
}

// ========== WELCOME SCREEN ==========
class WelcomeScreen extends StatelessWidget {
  const WelcomeScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Container(
        decoration: const BoxDecoration(
          gradient: LinearGradient(
            colors: [Color(0xFFD946A6), Color(0xFF7C4DFF)],
            begin: Alignment.topLeft,
            end: Alignment.bottomRight,
          ),
        ),
        child: Center(
          child: Padding(
            padding: const EdgeInsets.all(30),
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                const SizedBox(height: 40),
                Container(
                  width: 140,
                  height: 140,
                  decoration: BoxDecoration(
                    color: Colors.white,
                    borderRadius: BorderRadius.circular(30),
                    boxShadow: [
                      BoxShadow(
                        color: Colors.black.withOpacity(0.2),
                        blurRadius: 30,
                        spreadRadius: 5,
                      ),
                    ],
                  ),
                  child: const Icon(
                    Icons.shopping_bag_rounded,
                    size: 70,
                    color: Color(0xFFD946A6),
                  ),
                ),
                const SizedBox(height: 40),
                const Text(
                  'BRO MARKET',
                  style: TextStyle(
                    fontSize: 42,
                    fontWeight: FontWeight.bold,
                    color: Colors.white,
                    letterSpacing: 1.5,
                    shadows: [Shadow(blurRadius: 10, color: Colors.black26)],
                  ),
                ),
                const SizedBox(height: 10),
                const Text(
                  'Barcha dokonlardan arzonroq narxlar',
                  style: TextStyle(
                    fontSize: 16,
                    color: Colors.white70,
                    fontWeight: FontWeight.w500,
                  ),
                  textAlign: TextAlign.center,
                ),
                const SizedBox(height: 60),
                Column(
                  children: [
                    Container(
                      margin: const EdgeInsets.only(bottom: 20),
                      child: SizedBox(
                        width: double.infinity,
                        height: 58,
                        child: ElevatedButton(
                          onPressed: () {
                            ProductGenerator.generateProducts();
                            Navigator.pushReplacement(
                              context,
                              MaterialPageRoute(
                                builder: (context) => const MainScreen(),
                              ),
                            );
                          },
                          style: ElevatedButton.styleFrom(
                            backgroundColor: Colors.white,
                            foregroundColor: const Color(0xFFD946A6),
                            shape: RoundedRectangleBorder(
                              borderRadius: BorderRadius.circular(15),
                            ),
                            elevation: 10,
                            shadowColor: Colors.black.withOpacity(0.3),
                          ),
                          child: const Text(
                            'BROWSER MODE',
                            style: TextStyle(
                              fontSize: 17,
                              fontWeight: FontWeight.bold,
                            ),
                          ),
                        ),
                      ),
                    ),
                    SizedBox(
                      width: double.infinity,
                      height: 58,
                      child: OutlinedButton(
                        onPressed: () {},
                        style: OutlinedButton.styleFrom(
                          side: const BorderSide(color: Colors.white, width: 2),
                          shape: RoundedRectangleBorder(
                            borderRadius: BorderRadius.circular(15),
                          ),
                          backgroundColor: Colors.transparent,
                        ),
                        child: const Text(
                          'KIRISH',
                          style: TextStyle(
                            fontSize: 17,
                            fontWeight: FontWeight.bold,
                            color: Colors.white,
                          ),
                        ),
                      ),
                    ),
                  ],
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
}

// ========== MAIN SCREEN ==========
class MainScreen extends StatefulWidget {
  const MainScreen({super.key});

  @override
  State<MainScreen> createState() => _MainScreenState();
}

class _MainScreenState extends State<MainScreen> {
  int _selectedIndex = 0;

  final List<Widget> _screens = const [
    HomeScreen(),
    CategoriesScreen(),
    FavoritesScreen(),
    CartScreen(),
    ProfileScreen(),
  ];

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: _screens[_selectedIndex],
      bottomNavigationBar: Container(
        decoration: BoxDecoration(
          color: Colors.white,
          boxShadow: [
            BoxShadow(
              color: Colors.grey.withOpacity(0.1),
              blurRadius: 20,
              spreadRadius: 2,
            ),
          ],
        ),
        child: BottomNavigationBar(
          currentIndex: _selectedIndex,
          onTap: (index) {
            setState(() => _selectedIndex = index);
          },
          type: BottomNavigationBarType.fixed,
          selectedItemColor: const Color(0xFFD946A6),
          unselectedItemColor: Colors.grey[600],
          selectedLabelStyle: const TextStyle(
            fontWeight: FontWeight.bold,
            fontSize: 12,
          ),
          unselectedLabelStyle: const TextStyle(fontSize: 12),
          backgroundColor: Colors.transparent,
          elevation: 0,
          items: [
            BottomNavigationBarItem(
              icon: Container(
                padding: const EdgeInsets.all(8),
                decoration: _selectedIndex == 0
                    ? BoxDecoration(
                        color: const Color(0xFFD946A6).withOpacity(0.1),
                        borderRadius: BorderRadius.circular(12),
                      )
                    : null,
                child: Icon(
                  Icons.home_rounded,
                  size: 24,
                  color: _selectedIndex == 0
                      ? const Color(0xFFD946A6)
                      : Colors.grey[600],
                ),
              ),
              label: 'Asosiy',
            ),
            BottomNavigationBarItem(
              icon: Container(
                padding: const EdgeInsets.all(8),
                decoration: _selectedIndex == 1
                    ? BoxDecoration(
                        color: const Color(0xFFD946A6).withOpacity(0.1),
                        borderRadius: BorderRadius.circular(12),
                      )
                    : null,
                child: Icon(
                  Icons.category_rounded,
                  size: 24,
                  color: _selectedIndex == 1
                      ? const Color(0xFFD946A6)
                      : Colors.grey[600],
                ),
              ),
              label: 'Kategoriya',
            ),
            BottomNavigationBarItem(
              icon: Container(
                padding: const EdgeInsets.all(8),
                decoration: _selectedIndex == 2
                    ? BoxDecoration(
                        color: const Color(0xFFD946A6).withOpacity(0.1),
                        borderRadius: BorderRadius.circular(12),
                      )
                    : null,
                child: Stack(
                  children: [
                    Icon(
                      favoriteProducts.isEmpty
                          ? Icons.favorite_border_rounded
                          : Icons.favorite_rounded,
                      size: 24,
                      color: _selectedIndex == 2
                          ? const Color(0xFFD946A6)
                          : Colors.grey[600],
                    ),
                    if (favoriteProducts.isNotEmpty)
                      Positioned(
                        right: 0,
                        top: 0,
                        child: Container(
                          padding: const EdgeInsets.all(2),
                          decoration: const BoxDecoration(
                            color: Colors.red,
                            shape: BoxShape.circle,
                          ),
                          constraints: const BoxConstraints(
                            minWidth: 14,
                            minHeight: 14,
                          ),
                          child: Text(
                            favoriteProducts.length.toString(),
                            style: const TextStyle(
                              color: Colors.white,
                              fontSize: 8,
                              fontWeight: FontWeight.bold,
                            ),
                            textAlign: TextAlign.center,
                          ),
                        ),
                      ),
                  ],
                ),
              ),
              label: 'Saralangan',
            ),
            BottomNavigationBarItem(
              icon: Container(
                padding: const EdgeInsets.all(8),
                decoration: _selectedIndex == 3
                    ? BoxDecoration(
                        color: const Color(0xFFD946A6).withOpacity(0.1),
                        borderRadius: BorderRadius.circular(12),
                      )
                    : null,
                child: Stack(
                  children: [
                    Icon(
                      Icons.shopping_cart_rounded,
                      size: 24,
                      color: _selectedIndex == 3
                          ? const Color(0xFFD946A6)
                          : Colors.grey[600],
                    ),
                    if (cartItems.isNotEmpty)
                      Positioned(
                        right: 0,
                        top: 0,
                        child: Container(
                          padding: const EdgeInsets.all(2),
                          decoration: const BoxDecoration(
                            color: Colors.green,
                            shape: BoxShape.circle,
                          ),
                          constraints: const BoxConstraints(
                            minWidth: 14,
                            minHeight: 14,
                          ),
                          child: Text(
                            cartItems.length.toString(),
                            style: const TextStyle(
                              color: Colors.white,
                              fontSize: 8,
                              fontWeight: FontWeight.bold,
                            ),
                            textAlign: TextAlign.center,
                          ),
                        ),
                      ),
                  ],
                ),
              ),
              label: 'Savat',
            ),
            BottomNavigationBarItem(
              icon: Container(
                padding: const EdgeInsets.all(8),
                decoration: _selectedIndex == 4
                    ? BoxDecoration(
                        color: const Color(0xFFD946A6).withOpacity(0.1),
                        borderRadius: BorderRadius.circular(12),
                      )
                    : null,
                child: Icon(
                  Icons.person_rounded,
                  size: 24,
                  color: _selectedIndex == 4
                      ? const Color(0xFFD946A6)
                      : Colors.grey[600],
                ),
              ),
              label: 'Profil',
            ),
          ],
        ),
      ),
    );
  }
}

// ========== PRODUCT CARD ==========
class ProductCard extends StatelessWidget {
  final Product product;

  const ProductCard({super.key, required this.product});

  IconData _getIconForCategory() {
    switch (product.category) {
      case 'Telefon':
        return Icons.phone_iphone;
      case 'Parfyumeriya':
        return Icons.spa;
      case 'Avtomobil':
        return Icons.directions_car;
      case 'Kiyim':
        return Icons.checkroom;
      case 'Elektronika':
        return Icons.computer;
      case 'Uy-ro\'zg\'or':
        return Icons.home;
      default:
        return Icons.shopping_bag;
    }
  }

  Color _getColorForCategory() {
    switch (product.category) {
      case 'Telefon':
        return const Color(0xFF4CAF50);
      case 'Parfyumeriya':
        return const Color(0xFF9C27B0);
      case 'Avtomobil':
        return const Color(0xFF2196F3);
      case 'Kiyim':
        return const Color(0xFFFF9800);
      case 'Elektronika':
        return const Color(0xFF00BCD4);
      case 'Uy-ro\'zg\'or':
        return const Color(0xFFFF5722);
      default:
        return const Color(0xFFD946A6);
    }
  }

  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: () {
        Navigator.push(
          context,
          MaterialPageRoute(
            builder: (context) => ProductDetailScreen(product: product),
          ),
        );
      },
      child: Container(
        margin: const EdgeInsets.all(8),
        decoration: BoxDecoration(
          color: Colors.white,
          borderRadius: BorderRadius.circular(16),
          boxShadow: [
            BoxShadow(
              color: Colors.grey.withOpacity(0.1),
              blurRadius: 15,
              spreadRadius: 2,
            ),
          ],
        ),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // IMAGE/ICON
            Container(
              height: 100,
              width: double.infinity,
              decoration: BoxDecoration(
                color: _getColorForCategory().withOpacity(0.1),
                borderRadius: const BorderRadius.only(
                  topLeft: Radius.circular(16),
                  topRight: Radius.circular(16),
                ),
              ),
              child: Center(
                child: Icon(
                  _getIconForCategory(),
                  size: 70,
                  color: _getColorForCategory(),
                ),
              ),
            ),

            // CONTENT
            Padding(
              padding: const EdgeInsets.all(12),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  // DISCOUNT BADGE
                  Row(
                    children: [
                      Container(
                        padding: const EdgeInsets.symmetric(
                          horizontal: 8,
                          vertical: 4,
                        ),
                        decoration: BoxDecoration(
                          color: const Color(0xFF4CAF50).withOpacity(0.1),
                          borderRadius: BorderRadius.circular(8),
                        ),
                        child: Text(
                          '-${formatPrice(product.discountAmount)} so\'m',
                          style: const TextStyle(
                            color: Color(0xFF4CAF50),
                            fontSize: 12,
                            fontWeight: FontWeight.bold,
                          ),
                        ),
                      ),
                    ],
                  ),

                  const SizedBox(height: 8),

                  // TITLE
                  Text(
                    product.title,
                    style: const TextStyle(
                      fontSize: 10,
                      fontWeight: FontWeight.w600,
                      height: 1.3,
                    ),
                    maxLines: 1,
                    overflow: TextOverflow.ellipsis,
                  ),

                  const SizedBox(height: 8),

                  // PRICE
                  Text(
                    '${formatPrice(product.ourPrice)} so\'m',
                    style: const TextStyle(
                      fontSize: 18,
                      fontWeight: FontWeight.bold,
                      color: Color(0xFFD946A6),
                    ),
                  ),

                  const SizedBox(height: 4),

                  // ORIGINAL PRICE
                  Text(
                    '${product.storeName}: ${formatPrice(product.otherStorePrice)} so\'m',
                    style: const TextStyle(
                      fontSize: 11,
                      color: Colors.grey,
                      decoration: TextDecoration.lineThrough,
                    ),
                  ),

                  const SizedBox(height: 12),

                  // FOOTER
                  Row(
                    children: [
                      const Icon(
                        Icons.location_on_rounded,
                        size: 12,
                        color: Colors.grey,
                      ),
                      const SizedBox(width: 4),
                      Expanded(
                        child: Text(
                          product.location,
                          style: const TextStyle(
                            fontSize: 11,
                            color: Colors.grey,
                          ),
                          maxLines: 1,
                          overflow: TextOverflow.ellipsis,
                        ),
                      ),
                      Text(
                        product.timeAgo,
                        style: const TextStyle(
                          fontSize: 11,
                          color: Colors.grey,
                        ),
                      ),
                    ],
                  ),
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }
}

// ========== HOME SCREEN ==========
class HomeScreen extends StatefulWidget {
  const HomeScreen({super.key});

  @override
  State<HomeScreen> createState() => _HomeScreenState();
}

class _HomeScreenState extends State<HomeScreen> {
  final TextEditingController _searchController = TextEditingController();
  List<Product> _searchResults = [];

  void _performSearch(String query) {
    setState(() {
      _searchResults.clear();
      if (query.isNotEmpty) {
        _searchResults.addAll(
          allProducts.where((product) {
            return product.title.toLowerCase().contains(query.toLowerCase()) ||
                product.category.toLowerCase().contains(query.toLowerCase());
          }).toList(),
        );
      }
    });
  }

  @override
  void initState() {
    super.initState();
    _searchController.addListener(() {
      _performSearch(_searchController.text);
    });
  }

  @override
  Widget build(BuildContext context) {
    final featuredProducts = allProducts.take(12).toList();

    return Scaffold(
      appBar: AppBar(
        title: const Text(
          'BRO MARKET',
          style: TextStyle(
            fontWeight: FontWeight.bold,
            color: Color(0xFFD946A6),
          ),
        ),
        centerTitle: true,
        actions: [
          IconButton(
            icon: const Icon(Icons.notifications_rounded),
            onPressed: () {},
          ),
        ],
      ),
      body: SingleChildScrollView(
        child: Column(
          children: [
            // SEARCH BAR
            Padding(
              padding: const EdgeInsets.all(16),
              child: Container(
                decoration: BoxDecoration(
                  color: Colors.white,
                  borderRadius: BorderRadius.circular(15),
                  boxShadow: [
                    BoxShadow(
                      color: Colors.grey.withOpacity(0.1),
                      blurRadius: 15,
                      spreadRadius: 3,
                    ),
                  ],
                ),
                child: TextField(
                  controller: _searchController,
                  decoration: const InputDecoration(
                    hintText: 'Mahsulot nomi, kategoriya...',
                    border: InputBorder.none,
                    prefixIcon: Icon(
                      Icons.search_rounded,
                      color: Color(0xFFD946A6),
                    ),
                    contentPadding: EdgeInsets.symmetric(
                      horizontal: 20,
                      vertical: 15,
                    ),
                  ),
                ),
              ),
            ),

            // SEARCH RESULTS OR CONTENT
            if (_searchController.text.isNotEmpty)
              Column(
                children: _searchResults
                    .map((product) => ProductCard(product: product))
                    .toList(),
              )
            else ...[
              // BANNER
              Padding(
                padding: const EdgeInsets.symmetric(horizontal: 16),
                child: Container(
                  padding: const EdgeInsets.all(20),
                  decoration: BoxDecoration(
                    gradient: const LinearGradient(
                      colors: [Color(0xFFD946A6), Color(0xFF7C4DFF)],
                      begin: Alignment.topLeft,
                      end: Alignment.bottomRight,
                    ),
                    borderRadius: BorderRadius.circular(20),
                    boxShadow: [
                      BoxShadow(
                        color: const Color(0xFFD946A6).withOpacity(0.3),
                        blurRadius: 20,
                        spreadRadius: 2,
                      ),
                    ],
                  ),
                  child:  Row(
                    children: [
                      Icon(
                        Icons.savings_rounded,
                        size: 40,
                        color: Colors.white,
                      ),
                      SizedBox(width: 16),
                      Expanded(
                        child: Column(
                          crossAxisAlignment: CrossAxisAlignment.start,
                          children: [
                            Text(
                              'Barcha dokonlardan arzonroq!',
                              style: TextStyle(
                                color: Colors.white,
                                fontSize: 18,
                                fontWeight: FontWeight.bold,
                              ),
                            ),
                            SizedBox(height: 5),
                            Text(
                              'Uzum Market, OLX, Alif Shop va boshqalardan narxlarimiz past',
                              style: TextStyle(
                                color: Colors.white70,
                                fontSize: 13,
                              ),
                            ),
                          ],
                        ),
                      ),
                    ],
                  ),
                ),
              ),

              // CATEGORIES
              const SizedBox(height: 24),
              const Padding(
                padding: EdgeInsets.symmetric(horizontal: 16),
                child: Text(
                  'Kategoriyalar',
                  style: TextStyle(
                    fontSize: 22,
                    fontWeight: FontWeight.bold,
                    color: Colors.black87,
                  ),
                ),
              ),
              const SizedBox(height: 16),

              SizedBox(
                height: 100,
                child: ListView(
                  padding: const EdgeInsets.symmetric(horizontal: 16),
                  scrollDirection: Axis.horizontal,
                  children: const [
                    _CategoryCard(
                      name: 'Telefon',
                      icon: Icons.phone_android_rounded,
                      color: Color(0xFF4CAF50),
                    ),
                    _CategoryCard(
                      name: 'Parfyumeriya',
                      icon: Icons.spa_rounded,
                      color: Color(0xFF9C27B0),
                    ),
                    _CategoryCard(
                      name: 'Avtomobil',
                      icon: Icons.directions_car_rounded,
                      color: Color(0xFF2196F3),
                    ),
                    _CategoryCard(
                      name: 'Kiyim',
                      icon: Icons.checkroom_rounded,
                      color: Color(0xFFFF9800),
                    ),
                    _CategoryCard(
                      name: 'Elektronika',
                      icon: Icons.electrical_services_rounded,
                      color: Color(0xFF00BCD4),
                    ),
                    _CategoryCard(
                      name: 'Uy-ro\'zg\'or',
                      icon: Icons.home_rounded,
                      color: Color(0xFFFF5722),
                    ),
                  ],
                ),
              ),

              // FEATURED PRODUCTS
              const SizedBox(height: 32),
              Padding(
                padding: EdgeInsets.symmetric(horizontal: 16),
                child: Column(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Text(
                      'Arzon takliflar',
                      style: TextStyle(
                        fontSize: 22,
                        fontWeight: FontWeight.bold,
                        color: Colors.black87,
                      ),
                    ),
                    Text(
                      'Hammasini ko\'rish',
                      style: TextStyle(
                        color: Color(0xFFD946A6),
                        fontWeight: FontWeight.w600,
                      ),
                    ),
                  ],
                ),
              ),
              const SizedBox(height: 16),

              // PRODUCTS GRID
              GridView.builder(
                padding: const EdgeInsets.symmetric(horizontal: 16),
                shrinkWrap: true,
                physics: const NeverScrollableScrollPhysics(),
                gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
                  crossAxisCount: 2,
                  crossAxisSpacing: 12,
                  mainAxisSpacing: 12,
                  childAspectRatio: 0.65,
                ),
                itemCount: featuredProducts.length,
                itemBuilder: (context, index) {
                  return ProductCard(product: featuredProducts[index]);
                },
              ),
              const SizedBox(height: 30),
            ],
          ],
        ),
      ),
    );
  }
}

// CATEGORY CARD
class _CategoryCard extends StatelessWidget {
  final String name;
  final IconData icon;
  final Color color;

  const _CategoryCard({
    required this.name,
    required this.icon,
    required this.color,
  });

  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: () {
        Navigator.push(
          context,
          MaterialPageRoute(
            builder: (context) => CategoryProductsScreen(category: name),
          ),
        );
      },
      child: Container(
        width: 100,
        margin: const EdgeInsets.only(right: 12),
        decoration: BoxDecoration(
          color: Colors.white,
          borderRadius: BorderRadius.circular(16),
          boxShadow: [
            BoxShadow(
              color: Colors.grey.withOpacity(0.1),
              blurRadius: 10,
              spreadRadius: 2,
            ),
          ],
        ),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Container(
              padding: const EdgeInsets.all(18),
              decoration: BoxDecoration(
                color: color.withOpacity(0.1),
                shape: BoxShape.circle,
              ),
              child: Icon(icon, size: 30, color: color),
            ),
            const SizedBox(height: 12),
            Text(
              name,
              style: TextStyle(
                fontWeight: FontWeight.w600,
                color: color,
                fontSize: 13,
              ),
            ),
          ],
        ),
      ),
    );
  }
}

// ========== CATEGORY PRODUCTS SCREEN ==========
class CategoryProductsScreen extends StatelessWidget {
  final String category;

  const CategoryProductsScreen({super.key, required this.category});

  @override
  Widget build(BuildContext context) {
    final categoryProducts = allProducts
        .where((p) => p.category == category)
        .toList();

    return Scaffold(
      appBar: AppBar(title: Text(category)),
      body: categoryProducts.isEmpty
          ? Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const Icon(
                    Icons.category_rounded,
                    size: 80,
                    color: Colors.grey,
                  ),
                  const SizedBox(height: 16),
                  Text(
                    '$category bo\'yicha mahsulotlar topilmadi',
                    style: const TextStyle(fontSize: 18, color: Colors.grey),
                  ),
                ],
              ),
            )
          : GridView.builder(
              padding: const EdgeInsets.all(16),
              gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
                crossAxisCount: 2,
                crossAxisSpacing: 12,
                mainAxisSpacing: 12,
                childAspectRatio: 0.65,
              ),
              itemCount: categoryProducts.length,
              itemBuilder: (context, index) {
                return ProductCard(product: categoryProducts[index]);
              },
            ),
    );
  }
}

// ========== CATEGORIES SCREEN ==========
class CategoriesScreen extends StatelessWidget {
  const CategoriesScreen({super.key});

  @override
  Widget build(BuildContext context) {
    final categories = [
      'Telefon',
      'Parfyumeriya',
      'Avtomobil',
      'Kiyim',
      'Elektronika',
      'Uy-ro\'zg\'or',
    ];

    final categoryColors = [
      const Color(0xFF4CAF50),
      const Color(0xFF9C27B0),
      const Color(0xFF2196F3),
      const Color(0xFFFF9800),
      const Color(0xFF00BCD4),
      const Color(0xFFFF5722),
    ];

    final categoryIcons = [
      Icons.phone_android_rounded,
      Icons.spa_rounded,
      Icons.directions_car_rounded,
      Icons.checkroom_rounded,
      Icons.electrical_services_rounded,
      Icons.home_rounded,
    ];

    return Scaffold(
      appBar: AppBar(title: const Text('Kategoriyalar')),
      body: GridView.builder(
        padding: const EdgeInsets.all(16),
        gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
          crossAxisCount: 2,
          crossAxisSpacing: 16,
          mainAxisSpacing: 16,
          childAspectRatio: 1.5,
        ),
        itemCount: categories.length,
        itemBuilder: (context, index) {
          return Card(
            elevation: 4,
            shape: RoundedRectangleBorder(
              borderRadius: BorderRadius.circular(20),
            ),
            child: InkWell(
              onTap: () {
                Navigator.push(
                  context,
                  MaterialPageRoute(
                    builder: (context) =>
                        CategoryProductsScreen(category: categories[index]),
                  ),
                );
              },
              borderRadius: BorderRadius.circular(20),
              child: Container(
                decoration: BoxDecoration(
                  gradient: LinearGradient(
                    colors: [
                      categoryColors[index],
                      Color.lerp(categoryColors[index], Colors.white, 0.3)!,
                    ],
                    begin: Alignment.topLeft,
                    end: Alignment.bottomRight,
                  ),
                  borderRadius: BorderRadius.circular(20),
                ),
                child: Column(
                  mainAxisAlignment: MainAxisAlignment.center,
                  children: [
                    Icon(categoryIcons[index], size: 40, color: Colors.white),
                    const SizedBox(height: 12),
                    Text(
                      categories[index],
                      style: const TextStyle(
                        color: Colors.white,
                        fontSize: 18,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                  ],
                ),
              ),
            ),
          );
        },
      ),
    );
  }
}

// ========== FAVORITES SCREEN ==========
class FavoritesScreen extends StatefulWidget {
  const FavoritesScreen({super.key});

  @override
  State<FavoritesScreen> createState() => _FavoritesScreenState();
}

class _FavoritesScreenState extends State<FavoritesScreen> {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Saralanganlar')),
      body: favoriteProducts.isEmpty
          ? Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const Icon(
                    Icons.favorite_border_rounded,
                    size: 80,
                    color: Colors.grey,
                  ),
                  const SizedBox(height: 16),
                  const Text(
                    'Saralanganlar bo\'sh',
                    style: TextStyle(fontSize: 18, color: Colors.grey),
                  ),
                  const SizedBox(height: 8),
                  ElevatedButton(
                    onPressed: () {
                      Navigator.pop(context);
                    },
                    style: ElevatedButton.styleFrom(
                      backgroundColor: const Color(0xFFD946A6),
                    ),
                    child: const Text('Mahsulot qo\'shish'),
                  ),
                ],
              ),
            )
          : Column(
              children: [
                Padding(
                  padding: const EdgeInsets.all(16),
                  child: Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      Text(
                        '${favoriteProducts.length} ta mahsulot',
                        style: const TextStyle(
                          fontSize: 16,
                          fontWeight: FontWeight.w600,
                        ),
                      ),
                      TextButton(
                        onPressed: () {
                          setState(() => favoriteProducts.clear());
                        },
                        child: const Text(
                          'Tozalash',
                          style: TextStyle(color: Colors.red),
                        ),
                      ),
                    ],
                  ),
                ),
                Expanded(
                  child: GridView.builder(
                    padding: const EdgeInsets.symmetric(horizontal: 16),
                    gridDelegate:
                        const SliverGridDelegateWithFixedCrossAxisCount(
                          crossAxisCount: 2,
                          crossAxisSpacing: 12,
                          mainAxisSpacing: 12,
                          childAspectRatio: 0.65,
                        ),
                    itemCount: favoriteProducts.length,
                    itemBuilder: (context, index) {
                      return ProductCard(product: favoriteProducts[index]);
                    },
                  ),
                ),
              ],
            ),
    );
  }
}

// ========== CART SCREEN ==========
class CartScreen extends StatefulWidget {
  const CartScreen({super.key});

  @override
  State<CartScreen> createState() => _CartScreenState();
}

class _CartScreenState extends State<CartScreen> {
  double get totalPrice {
    return cartItems.fold(0, (sum, item) => sum + item.totalPrice);
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Savat'),
        actions: [
          if (cartItems.isNotEmpty)
            IconButton(
              icon: const Icon(Icons.delete_rounded),
              onPressed: () {
                setState(() => cartItems.clear());
              },
            ),
        ],
      ),
      body: cartItems.isEmpty
          ? Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const Icon(
                    Icons.shopping_cart_rounded,
                    size: 80,
                    color: Colors.grey,
                  ),
                  const SizedBox(height: 16),
                  const Text(
                    'Savat bo\'sh',
                    style: TextStyle(fontSize: 18, color: Colors.grey),
                  ),
                  const SizedBox(height: 8),
                  ElevatedButton(
                    onPressed: () {
                      Navigator.pop(context);
                    },
                    style: ElevatedButton.styleFrom(
                      backgroundColor: const Color(0xFFD946A6),
                    ),
                    child: const Text('Mahsulot qo\'shish'),
                  ),
                ],
              ),
            )
          : Column(
              children: [
                Expanded(
                  child: ListView.builder(
                    padding: const EdgeInsets.all(16),
                    itemCount: cartItems.length,
                    itemBuilder: (context, index) {
                      final item = cartItems[index];

                      IconData _getIconForCategory() {
                        switch (item.product.category) {
                          case 'Telefon':
                            return Icons.phone_iphone;
                          case 'Parfyumeriya':
                            return Icons.spa;
                          case 'Avtomobil':
                            return Icons.directions_car;
                          case 'Kiyim':
                            return Icons.checkroom;
                          case 'Elektronika':
                            return Icons.computer;
                          case 'Uy-ro\'zg\'or':
                            return Icons.home;
                          default:
                            return Icons.shopping_bag;
                        }
                      }

                      Color _getColorForCategory() {
                        switch (item.product.category) {
                          case 'Telefon':
                            return const Color(0xFF4CAF50);
                          case 'Parfyumeriya':
                            return const Color(0xFF9C27B0);
                          case 'Avtomobil':
                            return const Color(0xFF2196F3);
                          case 'Kiyim':
                            return const Color(0xFFFF9800);
                          case 'Elektronika':
                            return const Color(0xFF00BCD4);
                          case 'Uy-ro\'zg\'or':
                            return const Color(0xFFFF5722);
                          default:
                            return const Color(0xFFD946A6);
                        }
                      }

                      return Card(
                        margin: const EdgeInsets.only(bottom: 12),
                        shape: RoundedRectangleBorder(
                          borderRadius: BorderRadius.circular(16),
                        ),
                        child: ListTile(
                          leading: Container(
                            width: 56,
                            height: 56,
                            decoration: BoxDecoration(
                              color: _getColorForCategory().withOpacity(0.1),
                              borderRadius: BorderRadius.circular(12),
                            ),
                            child: Center(
                              child: Icon(
                                _getIconForCategory(),
                                color: _getColorForCategory(),
                                size: 30,
                              ),
                            ),
                          ),
                          title: Text(
                            item.product.title,
                            style: const TextStyle(fontWeight: FontWeight.w600),
                          ),
                          subtitle: Column(
                            crossAxisAlignment: CrossAxisAlignment.start,
                            children: [
                              const SizedBox(height: 4),
                              Text(
                                '${formatPrice(item.product.ourPrice)} so\'m',
                                style: const TextStyle(
                                  fontWeight: FontWeight.bold,
                                  color: Color(0xFFD946A6),
                                ),
                              ),
                              Text(
                                '${item.product.storeName}: ${formatPrice(item.product.otherStorePrice)} so\'m',
                                style: const TextStyle(
                                  fontSize: 11,
                                  color: Colors.grey,
                                  decoration: TextDecoration.lineThrough,
                                ),
                              ),
                            ],
                          ),
                          trailing: Row(
                            mainAxisSize: MainAxisSize.min,
                            children: [
                              IconButton(
                                icon: const Icon(Icons.remove_rounded),
                                onPressed: () {
                                  setState(() {
                                    if (item.quantity > 1) {
                                      item.quantity--;
                                    } else {
                                      cartItems.remove(item);
                                    }
                                  });
                                },
                              ),
                              Container(
                                padding: const EdgeInsets.symmetric(
                                  horizontal: 12,
                                  vertical: 4,
                                ),
                                decoration: BoxDecoration(
                                  color: const Color(
                                    0xFFD946A6,
                                  ).withOpacity(0.1),
                                  borderRadius: BorderRadius.circular(8),
                                ),
                                child: Text(
                                  '${item.quantity}',
                                  style: const TextStyle(
                                    fontWeight: FontWeight.bold,
                                    color: Color(0xFFD946A6),
                                  ),
                                ),
                              ),
                              IconButton(
                                icon: const Icon(Icons.add_rounded),
                                onPressed: () {
                                  setState(() => item.quantity++);
                                },
                              ),
                            ],
                          ),
                        ),
                      );
                    },
                  ),
                ),
                Container(
                  padding: const EdgeInsets.all(20),
                  decoration: BoxDecoration(
                    color: Colors.white,
                    border: Border(
                      top: BorderSide(color: Colors.grey.shade200),
                    ),
                    boxShadow: [
                      BoxShadow(
                        color: Colors.grey.withOpacity(0.1),
                        blurRadius: 20,
                        spreadRadius: 5,
                      ),
                    ],
                  ),
                  child: Column(
                    children: [
                      Row(
                        mainAxisAlignment: MainAxisAlignment.spaceBetween,
                        children: [
                          const Text(
                            'Jami summa:',
                            style: TextStyle(
                              fontSize: 18,
                              fontWeight: FontWeight.w600,
                            ),
                          ),
                          Text(
                            '${formatPrice(totalPrice)} so\'m',
                            style: const TextStyle(
                              fontSize: 22,
                              fontWeight: FontWeight.bold,
                              color: Color(0xFFD946A6),
                            ),
                          ),
                        ],
                      ),
                      const SizedBox(height: 20),
                      SizedBox(
                        width: double.infinity,
                        height: 58,
                        child: ElevatedButton(
                          onPressed: () {
                            // Checkout logic
                          },
                          style: ElevatedButton.styleFrom(
                            backgroundColor: const Color(0xFFD946A6),
                            shape: RoundedRectangleBorder(
                              borderRadius: BorderRadius.circular(15),
                            ),
                            elevation: 5,
                          ),
                          child: const Text(
                            'BUYURTMA BERISH',
                            style: TextStyle(
                              fontSize: 16,
                              fontWeight: FontWeight.bold,
                            ),
                          ),
                        ),
                      ),
                      const SizedBox(height: 10),
                      SizedBox(
                        width: double.infinity,
                        height: 58,
                        child: OutlinedButton(
                          onPressed: () {
                            setState(() => cartItems.clear());
                          },
                          style: OutlinedButton.styleFrom(
                            side: const BorderSide(color: Colors.red),
                            shape: RoundedRectangleBorder(
                              borderRadius: BorderRadius.circular(15),
                            ),
                          ),
                          child: const Text(
                            'SAVATNI TOZALASH',
                            style: TextStyle(
                              fontSize: 16,
                              fontWeight: FontWeight.bold,
                              color: Colors.red,
                            ),
                          ),
                        ),
                      ),
                    ],
                  ),
                ),
              ],
            ),
    );
  }
}

// ========== PROFILE SCREEN ==========
class ProfileScreen extends StatelessWidget {
  const ProfileScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: CustomScrollView(
        slivers: [
          SliverAppBar(
            expandedHeight: 200,
            flexibleSpace: FlexibleSpaceBar(
              background: Container(
                decoration: const BoxDecoration(
                  gradient: LinearGradient(
                    colors: [Color(0xFFD946A6), Color(0xFF7C4DFF)],
                    begin: Alignment.topLeft,
                    end: Alignment.bottomRight,
                  ),
                ),
                child: SafeArea(
                  child: Center(
                    child: Column(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        Container(
                          width: 100,
                          height: 100,
                          decoration: BoxDecoration(
                            color: Colors.white.withOpacity(0.2),
                            shape: BoxShape.circle,
                          ),
                          child: const Icon(
                            Icons.person_rounded,
                            size: 60,
                            color: Colors.white,
                          ),
                        ),
                        const SizedBox(height: 16),
                        Text(
                          currentUser.name,
                          style: const TextStyle(
                            fontSize: 24,
                            fontWeight: FontWeight.bold,
                            color: Colors.white,
                          ),
                        ),
                        const SizedBox(height: 8),
                        Text(
                          currentUser.phone,
                          style: const TextStyle(
                            fontSize: 16,
                            color: Colors.white70,
                          ),
                        ),
                      ],
                    ),
                  ),
                ),
              ),
            ),
          ),
          SliverList(
            delegate: SliverChildListDelegate([
              const SizedBox(height: 20),
              Padding(
                padding: const EdgeInsets.symmetric(horizontal: 20),
                child: Card(
                  elevation: 4,
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(16),
                  ),
                  child: Padding(
                    padding: const EdgeInsets.all(16),
                    child: Row(
                      mainAxisAlignment: MainAxisAlignment.spaceAround,
                      children: [
                        Column(
                          children: [
                            Text(
                              currentUser.ordersCount.toString(),
                              style: const TextStyle(
                                fontSize: 24,
                                fontWeight: FontWeight.bold,
                                color: Color(0xFFD946A6),
                              ),
                            ),
                            const SizedBox(height: 4),
                            const Text(
                              'Buyurtmalar',
                              style: TextStyle(color: Colors.grey),
                            ),
                          ],
                        ),
                        Column(
                          children: [
                            Text(
                              formatPrice(currentUser.totalSpent),
                              style: const TextStyle(
                                fontSize: 24,
                                fontWeight: FontWeight.bold,
                                color: Color(0xFFD946A6),
                              ),
                            ),
                            const SizedBox(height: 4),
                            const Text(
                              'Sarflangan',
                              style: TextStyle(color: Colors.grey),
                            ),
                          ],
                        ),
                        Column(
                          children: [
                            Text(
                              favoriteProducts.length.toString(),
                              style: const TextStyle(
                                fontSize: 24,
                                fontWeight: FontWeight.bold,
                                color: Color(0xFFD946A6),
                              ),
                            ),
                            const SizedBox(height: 4),
                            const Text(
                              'Saralangan',
                              style: TextStyle(color: Colors.grey),
                            ),
                          ],
                        ),
                      ],
                    ),
                  ),
                ),
              ),
              const SizedBox(height: 20),
              Card(
                margin: const EdgeInsets.symmetric(horizontal: 20, vertical: 8),
                shape: RoundedRectangleBorder(
                  borderRadius: BorderRadius.circular(16),
                ),
                child: Column(
                  children: [
                    ListTile(
                      leading: Container(
                        padding: const EdgeInsets.all(10),
                        decoration: BoxDecoration(
                          color: const Color(0xFF4CAF50).withOpacity(0.1),
                          shape: BoxShape.circle,
                        ),
                        child: const Icon(
                          Icons.shopping_bag_rounded,
                          color: Color(0xFF4CAF50),
                        ),
                      ),
                      title: const Text('Mening buyurtmalarim'),
                      trailing: const Icon(Icons.arrow_forward_ios_rounded),
                      onTap: () {},
                    ),
                    const Divider(height: 0, indent: 70),
                    ListTile(
                      leading: Container(
                        padding: const EdgeInsets.all(10),
                        decoration: BoxDecoration(
                          color: Colors.red.withOpacity(0.1),
                          shape: BoxShape.circle,
                        ),
                        child: const Icon(
                          Icons.favorite_rounded,
                          color: Colors.red,
                        ),
                      ),
                      title: const Text('Saralanganlar'),
                      trailing: Badge(
                        label: Text(favoriteProducts.length.toString()),
                        child: const Icon(Icons.arrow_forward_ios_rounded),
                      ),
                      onTap: () {
                        Navigator.push(
                          context,
                          MaterialPageRoute(
                            builder: (context) => const FavoritesScreen(),
                          ),
                        );
                      },
                    ),
                    const Divider(height: 0, indent: 70),
                    ListTile(
                      leading: Container(
                        padding: const EdgeInsets.all(10),
                        decoration: BoxDecoration(
                          color: Colors.blue.withOpacity(0.1),
                          shape: BoxShape.circle,
                        ),
                        child: const Icon(
                          Icons.settings_rounded,
                          color: Colors.blue,
                        ),
                      ),
                      title: const Text('Sozlamalar'),
                      trailing: const Icon(Icons.arrow_forward_ios_rounded),
                      onTap: () {
                        Navigator.push(
                          context,
                          MaterialPageRoute(
                            builder: (context) => const SettingsScreen(),
                          ),
                        );
                      },
                    ),
                    const Divider(height: 0, indent: 70),
                    ListTile(
                      leading: Container(
                        padding: const EdgeInsets.all(10),
                        decoration: BoxDecoration(
                          color: Colors.orange.withOpacity(0.1),
                          shape: BoxShape.circle,
                        ),
                        child: const Icon(
                          Icons.help_rounded,
                          color: Colors.orange,
                        ),
                      ),
                      title: const Text('Yordam va qo\'llab-quvvatlash'),
                      trailing: const Icon(Icons.arrow_forward_ios_rounded),
                      onTap: () {
                        Navigator.push(
                          context,
                          MaterialPageRoute(
                            builder: (context) => const HelpScreen(),
                          ),
                        );
                      },
                    ),
                  ],
                ),
              ),
              const SizedBox(height: 20),
              Padding(
                padding: const EdgeInsets.symmetric(horizontal: 20),
                child: SizedBox(
                  width: double.infinity,
                  height: 58,
                  child: OutlinedButton.icon(
                    onPressed: () {
                      Navigator.pushReplacement(
                        context,
                        MaterialPageRoute(
                          builder: (context) => const WelcomeScreen(),
                        ),
                      );
                    },
                    style: OutlinedButton.styleFrom(
                      side: const BorderSide(color: Colors.red),
                      shape: RoundedRectangleBorder(
                        borderRadius: BorderRadius.circular(15),
                      ),
                    ),
                    icon: const Icon(Icons.logout_rounded, color: Colors.red),
                    label: const Text(
                      'CHIQISH',
                      style: TextStyle(
                        color: Colors.red,
                        fontWeight: FontWeight.bold,
                        fontSize: 16,
                      ),
                    ),
                  ),
                ),
              ),
              const SizedBox(height: 40),
            ]),
          ),
        ],
      ),
    );
  }
}

// ========== SETTINGS SCREEN ==========
class SettingsScreen extends StatelessWidget {
  const SettingsScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Sozlamalar')),
      body: ListView(
        padding: const EdgeInsets.all(16),
        children: [
          Card(
            child: SwitchListTile(
              title: const Text('Push-bildirishnomalar'),
              subtitle: const Text(
                'Yangiliklar va chegirmalar haqida xabarlar',
              ),
              value: true,
              onChanged: (value) {},
            ),
          ),
          const SizedBox(height: 12),
          Card(
            child: SwitchListTile(
              title: const Text('Tungi rejim'),
              subtitle: const Text('Qorong\'u mavzuni faollashtirish'),
              value: false,
              onChanged: (value) {},
            ),
          ),
          const SizedBox(height: 12),
          Card(
            child: ListTile(
              title: const Text('Til'),
              subtitle: const Text('O\'zbekcha'),
              trailing: const Icon(Icons.arrow_forward_ios_rounded),
              onTap: () {},
            ),
          ),
          const SizedBox(height: 12),
          Card(
            child: ListTile(
              title: const Text('Valyuta'),
              subtitle: const Text('UZS - So\'m'),
              trailing: const Icon(Icons.arrow_forward_ios_rounded),
              onTap: () {},
            ),
          ),
          const SizedBox(height: 12),
          Card(
            child: ListTile(
              title: const Text('Maxfiylik siyosati'),
              trailing: const Icon(Icons.arrow_forward_ios_rounded),
              onTap: () {},
            ),
          ),
          const SizedBox(height: 12),
          Card(
            child: ListTile(
              title: const Text('Foydalanish shartlari'),
              trailing: const Icon(Icons.arrow_forward_ios_rounded),
              onTap: () {},
            ),
          ),
          const SizedBox(height: 12),
          Card(
            child: ListTile(
              title: const Text('Ilova versiyasi'),
              subtitle: const Text('1.0.0'),
              onTap: () {},
            ),
          ),
        ],
      ),
    );
  }
}

// ========== HELP SCREEN ==========
class HelpScreen extends StatelessWidget {
  const HelpScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Yordam')),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(20),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Card(
              child: ListTile(
                leading: Container(
                  padding: const EdgeInsets.all(10),
                  decoration: BoxDecoration(
                    color: Colors.green.withOpacity(0.1),
                    shape: BoxShape.circle,
                  ),
                  child: const Icon(Icons.phone_rounded, color: Colors.green),
                ),
                title: const Text('Qo\'llab-quvvatlash xizmati'),
                subtitle: const Text('+998 91 708 08 13'),
                onTap: () {},
              ),
            ),
            const SizedBox(height: 12),
            Card(
              child: ListTile(
                leading: Container(
                  padding: const EdgeInsets.all(10),
                  decoration: BoxDecoration(
                    color: Colors.blue.withOpacity(0.1),
                    shape: BoxShape.circle,
                  ),
                  child: const Icon(Icons.email_rounded, color: Colors.blue),
                ),
                title: const Text('Elektron pochta'),
                subtitle: const Text('support@bromarket.uz'),
                onTap: () {},
              ),
            ),
            const SizedBox(height: 12),
            Card(
              child: ListTile(
                leading: Container(
                  padding: const EdgeInsets.all(10),
                  decoration: BoxDecoration(
                    color: const Color(0xFF1DA1F2).withOpacity(0.1),
                    shape: BoxShape.circle,
                  ),
                  child: const Icon(
                    Icons.telegram_rounded,
                    color: Color(0xFF1DA1F2),
                  ),
                ),
                title: const Text('Telegram yordam'),
                subtitle: const Text('@UM1D797'),
                onTap: () {
                  // Telegram link removed for DartPad
                },
              ),
            ),
            const SizedBox(height: 30),
            const Text(
              'Tez-tez beriladigan savollar:',
              style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
            ),
            const SizedBox(height: 16),
            ExpansionTile(
              title: const Text('Buyurtmani qanday bekor qilish mumkin?'),
              children: [
                Padding(
                  padding: const EdgeInsets.all(16),
                  child: Text(
                    'Buyurtma berilgandan keyin 1 soat ichida bekor qilish mumkin. '
                    'Buning uchun "Mening buyurtmalarim" bo\'limiga o\'ting va '
                    'bekor qilish tugmasini bosing.',
                    style: TextStyle(color: Colors.grey[700]),
                  ),
                ),
              ],
            ),
            ExpansionTile(
              title: const Text('Yetkazib berish qancha vaqt oladi?'),
              children: [
                Padding(
                  padding: const EdgeInsets.all(16),
                  child: Text(
                    'Toshkent shahri ichida 1-2 ish kuni, viloyatlarga 3-5 ish kuni. '
                    'Yetkazib berish narxi mahsulot narxiga kiritilgan.',
                    style: TextStyle(color: Colors.grey[700]),
                  ),
                ),
              ],
            ),
            ExpansionTile(
              title: const Text('Mahsulotni qaytarish mumkinmi?'),
              children: [
                Padding(
                  padding: const EdgeInsets.all(16),
                  child: Text(
                    'Ha, mahsulotni olgan kundan boshlab 14 kun ichida '
                    'qaytarishingiz mumkin. Mahsulot dastlabki holatida '
                    'va qutisi bilan birga bo\'lishi kerak.',
                    style: TextStyle(color: Colors.grey[700]),
                  ),
                ),
              ],
            ),
            ExpansionTile(
              title: const Text('BRO MARKET boshqa dokonlardan qancha arzon?'),
              children: [
                Padding(
                  padding: const EdgeInsets.all(16),
                  child: Text(
                    'Biz barcha mahsulotlarni Uzum Market, OLX, Alif Shop va '
                    'boshqa mashhur dokonlardan 5,000 dan 500,000 so\'mgacha '
                    'arzonroq taklif qilamiz.',
                    style: TextStyle(color: Colors.grey[700]),
                  ),
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }
}

// ========== PRODUCT DETAIL SCREEN ==========
class ProductDetailScreen extends StatefulWidget {
  final Product product;

  const ProductDetailScreen({super.key, required this.product});

  @override
  State<ProductDetailScreen> createState() => _ProductDetailScreenState();
}

class _ProductDetailScreenState extends State<ProductDetailScreen> {
  int quantity = 1;
  bool isFavorite = false;

  @override
  void initState() {
    super.initState();
    isFavorite = favoriteProducts.contains(widget.product);
  }

  void toggleFavorite() {
    setState(() {
      isFavorite = !isFavorite;
      if (isFavorite) {
        favoriteProducts.add(widget.product);
      } else {
        favoriteProducts.remove(widget.product);
      }
    });
  }

  void addToCart() {
    final existingItem = cartItems.firstWhere(
      (item) => item.product.id == widget.product.id,
      orElse: () => CartItem(product: widget.product, quantity: 0),
    );

    if (existingItem.quantity == 0) {
      cartItems.add(CartItem(product: widget.product, quantity: quantity));
    } else {
      existingItem.quantity += quantity;
    }

    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: const Text('Savatga qo\'shildi'),
        backgroundColor: const Color(0xFFD946A6),
        behavior: SnackBarBehavior.floating,
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),
      ),
    );
  }

  IconData _getIconForCategory() {
    switch (widget.product.category) {
      case 'Telefon':
        return Icons.phone_iphone;
      case 'Parfyumeriya':
        return Icons.spa;
      case 'Avtomobil':
        return Icons.directions_car;
      case 'Kiyim':
        return Icons.checkroom;
      case 'Elektronika':
        return Icons.computer;
      case 'Uy-ro\'zg\'or':
        return Icons.home;
      default:
        return Icons.shopping_bag;
    }
  }

  Color _getColorForCategory() {
    switch (widget.product.category) {
      case 'Telefon':
        return const Color(0xFF4CAF50);
      case 'Parfyumeriya':
        return const Color(0xFF9C27B0);
      case 'Avtomobil':
        return const Color(0xFF2196F3);
      case 'Kiyim':
        return const Color(0xFFFF9800);
      case 'Elektronika':
        return const Color(0xFF00BCD4);
      case 'Uy-ro\'zg\'or':
        return const Color(0xFFFF5722);
      default:
        return const Color(0xFFD946A6);
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: CustomScrollView(
        slivers: [
          SliverAppBar(
            expandedHeight: 300,
            floating: false,
            pinned: true,
            flexibleSpace: FlexibleSpaceBar(
              background: Container(
                decoration: BoxDecoration(
                  color: _getColorForCategory().withOpacity(0.1),
                ),
                child: Center(
                  child: Icon(
                    _getIconForCategory(),
                    size: 120,
                    color: _getColorForCategory(),
                  ),
                ),
              ),
            ),
            actions: [
              IconButton(
                icon: Container(
                  padding: const EdgeInsets.all(8),
                  decoration: BoxDecoration(
                    color: Colors.black.withOpacity(0.3),
                    shape: BoxShape.circle,
                  ),
                  child: Icon(
                    isFavorite
                        ? Icons.favorite_rounded
                        : Icons.favorite_border_rounded,
                    color: isFavorite ? Colors.red : Colors.white,
                  ),
                ),
                onPressed: toggleFavorite,
              ),
            ],
          ),
          SliverToBoxAdapter(
            child: Padding(
              padding: const EdgeInsets.all(20),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  // PRICE COMPARISON
                  Card(
                    elevation: 4,
                    shape: RoundedRectangleBorder(
                      borderRadius: BorderRadius.circular(16),
                    ),
                    child: Padding(
                      padding: const EdgeInsets.all(20),
                      child: Column(
                        children: [
                          Row(
                            mainAxisAlignment: MainAxisAlignment.spaceBetween,
                            children: [
                              Column(
                                crossAxisAlignment: CrossAxisAlignment.start,
                                children: [
                                  Text(
                                    widget.product.storeName,
                                    style: const TextStyle(
                                      fontSize: 14,
                                      color: Colors.grey,
                                    ),
                                  ),
                                  const SizedBox(height: 4),
                                  Text(
                                    '${formatPrice(widget.product.otherStorePrice)} so\'m',
                                    style: const TextStyle(
                                      fontSize: 18,
                                      fontWeight: FontWeight.w600,
                                      decoration: TextDecoration.lineThrough,
                                    ),
                                  ),
                                ],
                              ),
                              Container(
                                padding: const EdgeInsets.symmetric(
                                  horizontal: 16,
                                  vertical: 8,
                                ),
                                decoration: BoxDecoration(
                                  color: const Color(
                                    0xFF4CAF50,
                                  ).withOpacity(0.1),
                                  borderRadius: BorderRadius.circular(20),
                                ),
                                child: Text(
                                  '-${formatPrice(widget.product.discountAmount)} so\'m',
                                  style: const TextStyle(
                                    fontSize: 16,
                                    fontWeight: FontWeight.bold,
                                    color: Color(0xFF4CAF50),
                                  ),
                                ),
                              ),
                            ],
                          ),
                          const SizedBox(height: 16),
                          Row(
                            mainAxisAlignment: MainAxisAlignment.spaceBetween,
                            children: [
                              const Text(
                                'BRO MARKET:',
                                style: TextStyle(
                                  fontSize: 16,
                                  fontWeight: FontWeight.w600,
                                  color: Colors.black87,
                                ),
                              ),
                              Text(
                                '${formatPrice(widget.product.ourPrice)} so\'m',
                                style: const TextStyle(
                                  fontSize: 28,
                                  fontWeight: FontWeight.bold,
                                  color: Color(0xFFD946A6),
                                ),
                              ),
                            ],
                          ),
                          const SizedBox(height: 12),
                          LinearProgressIndicator(
                            value: widget.product.discountPercentage / 100,
                            backgroundColor: Colors.grey[200],
                            valueColor: const AlwaysStoppedAnimation<Color>(
                              Color(0xFF4CAF50),
                            ),
                          ),
                          const SizedBox(height: 8),
                          Text(
                            '${widget.product.discountPercentage.toStringAsFixed(1)}% chegirma',
                            style: const TextStyle(
                              fontSize: 12,
                              color: Colors.grey,
                            ),
                          ),
                        ],
                      ),
                    ),
                  ),

                  const SizedBox(height: 24),

                  // PRODUCT INFO
                  Text(
                    widget.product.title,
                    style: const TextStyle(
                      fontSize: 24,
                      fontWeight: FontWeight.bold,
                      color: Colors.black87,
                    ),
                  ),
                  const SizedBox(height: 12),
                  Text(
                    widget.product.description,
                    style: TextStyle(
                      fontSize: 16,
                      color: Colors.grey[700],
                      height: 1.6,
                    ),
                  ),

                  const SizedBox(height: 24),

                  // SELLER INFO
                  Card(
                    elevation: 2,
                    shape: RoundedRectangleBorder(
                      borderRadius: BorderRadius.circular(16),
                    ),
                    child: Padding(
                      padding: const EdgeInsets.all(16),
                      child: Column(
                        children: [
                          Row(
                            children: [
                              Container(
                                padding: const EdgeInsets.all(10),
                                decoration: BoxDecoration(
                                  color: const Color(
                                    0xFFD946A6,
                                  ).withOpacity(0.1),
                                  shape: BoxShape.circle,
                                ),
                                child: const Icon(
                                  Icons.store_rounded,
                                  color: Color(0xFFD946A6),
                                ),
                              ),
                              const SizedBox(width: 12),
                              Expanded(
                                child: Column(
                                  crossAxisAlignment: CrossAxisAlignment.start,
                                  children: [
                                    const Text(
                                      'Sotuvchi:',
                                      style: TextStyle(
                                        fontSize: 12,
                                        color: Colors.grey,
                                      ),
                                    ),
                                    Text(
                                      widget.product.sellerName,
                                      style: const TextStyle(
                                        fontSize: 16,
                                        fontWeight: FontWeight.w600,
                                      ),
                                    ),
                                  ],
                                ),
                              ),
                            ],
                          ),
                          const SizedBox(height: 12),
                          Row(
                            children: [
                              Container(
                                padding: const EdgeInsets.all(10),
                                decoration: BoxDecoration(
                                  color: Colors.blue.withOpacity(0.1),
                                  shape: BoxShape.circle,
                                ),
                                child: const Icon(
                                  Icons.location_on_rounded,
                                  color: Colors.blue,
                                ),
                              ),
                              const SizedBox(width: 12),
                              Expanded(
                                child: Column(
                                  crossAxisAlignment: CrossAxisAlignment.start,
                                  children: [
                                    const Text(
                                      'Manzil:',
                                      style: TextStyle(
                                        fontSize: 12,
                                        color: Colors.grey,
                                      ),
                                    ),
                                    Text(
                                      widget.product.location,
                                      style: const TextStyle(
                                        fontSize: 16,
                                        fontWeight: FontWeight.w600,
                                      ),
                                    ),
                                  ],
                                ),
                              ),
                            ],
                          ),
                          const SizedBox(height: 12),
                          Row(
                            children: [
                              Container(
                                padding: const EdgeInsets.all(10),
                                decoration: BoxDecoration(
                                  color: Colors.green.withOpacity(0.1),
                                  shape: BoxShape.circle,
                                ),
                                child: const Icon(
                                  Icons.phone_rounded,
                                  color: Colors.green,
                                ),
                              ),
                              const SizedBox(width: 12),
                              Expanded(
                                child: Column(
                                  crossAxisAlignment: CrossAxisAlignment.start,
                                  children: [
                                    const Text(
                                      'Telefon:',
                                      style: TextStyle(
                                        fontSize: 12,
                                        color: Colors.grey,
                                      ),
                                    ),
                                    Text(
                                      widget.product.sellerPhone,
                                      style: const TextStyle(
                                        fontSize: 16,
                                        fontWeight: FontWeight.w600,
                                      ),
                                    ),
                                  ],
                                ),
                              ),
                            ],
                          ),
                        ],
                      ),
                    ),
                  ),

                  const SizedBox(height: 32),

                  // QUANTITY AND BUY
                  Card(
                    elevation: 4,
                    shape: RoundedRectangleBorder(
                      borderRadius: BorderRadius.circular(16),
                    ),
                    child: Padding(
                      padding: const EdgeInsets.all(20),
                      child: Column(
                        children: [
                          Row(
                            children: [
                              const Text(
                                'Miqdor:',
                                style: TextStyle(
                                  fontSize: 16,
                                  fontWeight: FontWeight.w600,
                                ),
                              ),
                              const Spacer(),
                              Container(
                                decoration: BoxDecoration(
                                  border: Border.all(
                                    color: const Color(0xFFD946A6),
                                    width: 2,
                                  ),
                                  borderRadius: BorderRadius.circular(12),
                                ),
                                child: Row(
                                  children: [
                                    IconButton(
                                      icon: const Icon(Icons.remove_rounded),
                                      color: const Color(0xFFD946A6),
                                      onPressed: () {
                                        if (quantity > 1) {
                                          setState(() => quantity--);
                                        }
                                      },
                                    ),
                                    Container(
                                      padding: const EdgeInsets.symmetric(
                                        horizontal: 20,
                                      ),
                                      child: Text(
                                        '$quantity',
                                        style: const TextStyle(
                                          fontSize: 18,
                                          fontWeight: FontWeight.bold,
                                          color: Color(0xFFD946A6),
                                        ),
                                      ),
                                    ),
                                    IconButton(
                                      icon: const Icon(Icons.add_rounded),
                                      color: const Color(0xFFD946A6),
                                      onPressed: () {
                                        setState(() => quantity++);
                                      },
                                    ),
                                  ],
                                ),
                              ),
                            ],
                          ),
                          const SizedBox(height: 20),
                          Row(
                            children: [
                              Expanded(
                                child: SizedBox(
                                  height: 56,
                                  child: OutlinedButton.icon(
                                    onPressed: addToCart,
                                    style: OutlinedButton.styleFrom(
                                      side: const BorderSide(
                                        color: Color(0xFFD946A6),
                                        width: 2,
                                      ),
                                      shape: RoundedRectangleBorder(
                                        borderRadius: BorderRadius.circular(12),
                                      ),
                                    ),
                                    icon: const Icon(
                                      Icons.shopping_cart_rounded,
                                      color: Color(0xFFD946A6),
                                    ),
                                    label: const Text(
                                      'SAVATGA',
                                      style: TextStyle(
                                        fontSize: 16,
                                        fontWeight: FontWeight.bold,
                                        color: Color(0xFFD946A6),
                                      ),
                                    ),
                                  ),
                                ),
                              ),
                              const SizedBox(width: 16),
                              Expanded(
                                child: SizedBox(
                                  height: 56,
                                  child: ElevatedButton.icon(
                                    onPressed: () {
                                      addToCart();
                                      Navigator.pop(context);
                                    },
                                    style: ElevatedButton.styleFrom(
                                      backgroundColor: const Color(0xFFD946A6),
                                      shape: RoundedRectangleBorder(
                                        borderRadius: BorderRadius.circular(12),
                                      ),
                                    ),
                                    icon: const Icon(
                                      Icons.shopping_bag_rounded,
                                    ),
                                    label: const Text(
                                      'SOTIB OLISH',
                                      style: TextStyle(
                                        fontSize: 16,
                                        fontWeight: FontWeight.bold,
                                      ),
                                    ),
                                  ),
                                ),
                              ),
                            ],
                          ),
                        ],
                      ),
                    ),
                  ),

                  const SizedBox(height: 40),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
}
